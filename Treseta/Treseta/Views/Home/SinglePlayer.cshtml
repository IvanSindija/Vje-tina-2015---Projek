<div>
    <canvas id="myCanvas" width="1000" height="700" style="border:1px solid #000000;"></canvas>
</div>
<h2 position = "center">@ViewData["korisnik"]</h2>

@section scripts{
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>

        $(function () {
            // Reference the auto-generated proxy for the hub.
            var hub = $.connection.spHub;
            var name = @Html.Raw(Json.Encode(ViewData["korisnik"]));
            var c=document.getElementById("myCanvas");
            var ctx=c.getContext("2d");

            hub.client.pocetakIgre = function(ruka){
                nacrtajKarte(ruka , 10 , ctx);//prvih 10 karata sto smo dobili iscrtavamo na platno
            };

            hub.client.upozorenje = function(poruka){
                alert(poruka);
            }
            //********************************KRESI ZA IMPLEMENTIRANJE**************************************************************
            hub.client.odgovor = function(rukuIgraca, kartuBacenuOdIgraca,kartuIzvucenuAI, kataIzvucenaIgrac){

            }

            hub.client.aiIgra = function(karta){

            }

            hub.client.noviKrug = function(rukuIgraca, kartuBacenuOdIgraca, kartuBacenuOdAI, kartuIzvucenuAI, kataIzvucenaIgrac) {

            }
            //***********************************************************************************************************************
            // Start the connection.
            $.connection.hub.start().done(function () {
                //spojin se u sobu
                hub.server.joinRoom(name);

                $("#myCanvas").click(function(evt) {
                    var  mouseX = parseInt(evt.clientX - c.offsetLeft);
                    var mouseY = parseInt(evt.clientY-c.offsetTop + window.pageYOffset);
                    chat.server.cardClick(mouseX,mouseY);
                });

            });

        });

        //dobije n karata i iscrta ih na platno ctx je referenca na platno
        function nacrtajKarte(ruka , n , ctx){
            var imgs = [];
            var imagesOK=0;
            for(i=0;i<n;i++){
                var karta = ruka[i];
                var img = new Image();
                imgs.push(img);
                img.src = karta.pathSlike;
                img.onload = function(){
                    imagesOK++;
                    if (imagesOK>= n  ){
                        for(j=0;j<n;j++)
                            ctx.drawImage(imgs[j],parseInt(ruka[j].xPoz),590,parseInt(ruka[j].sirina),parseInt(ruka[j].visina));
                    };
                };
            };
        };
    </script>

}